<?php
//session_start();
require_once '../check_session.php';
require_once '../db_conn.php';

checkLogin(); // ตรวจสอบว่าล็อกอินแล้วหรือยัง
$user = getUserInfo();

$evaluation_id = isset($_GET['id']) ? (int)$_GET['id'] : 0;

if ($evaluation_id == 0) {
    $_SESSION['error'] = "ไม่พบข้อมูลการประเมิน";
    header("Location: children_list.php");
    exit();
}

// ดึงข้อมูลการประเมิน - ตรวจสอบสิทธิ์ตาม role
if ($user['user_role'] === 'admin' || $user['user_role'] === 'staff') {
    // Admin และ Staff ดูได้ทุกการประเมิน
    $sql = "SELECT e.*, c.chi_child_name as child_name, c.chi_photo as photo 
            FROM evaluations e 
            JOIN children c ON e.eva_child_id = c.chi_id 
            WHERE e.eva_id = ?";
    $stmt = $conn->prepare($sql);
    $stmt->bind_param("i", $evaluation_id);
} else {
    // User ปกติดูได้เฉพาะของตัวเอง
    $sql = "SELECT e.*, c.chi_child_name as child_name, c.chi_photo as photo 
            FROM evaluations e 
            JOIN children c ON e.eva_child_id = c.chi_id 
            WHERE e.eva_id = ? AND e.eva_user_id = ?";
    $stmt = $conn->prepare($sql);
    $stmt->bind_param("ii", $evaluation_id, $user['user_id']);
}
$stmt->execute();
$result = $stmt->get_result();

if ($result->num_rows == 0) {
    $_SESSION['error'] = "ไม่พบข้อมูลการประเมินที่ต้องการดู";
    header("Location: children_list.php");
    exit();
}

$evaluation = $result->fetch_assoc();
$responses = json_decode($evaluation['eva_responses'], true);

$stmt->close();
$conn->close();

// ฟังก์ชันสำหรับสร้างคำถามตามช่วงอายุ
function getQuestionsByAgeRange($age_range) {
    // ข้อคำถามสำหรับ 0-1 เดือน
    $questions_0_1 = [
        1 => [
            'skill' => 'ท่านอนคว่ำยกศีรษะและหันไปข้างใดข้างหนึ่งได้ (GM)',
            'method' => 'จัดให้เด็กอยู่ในท่านอนคว่ำบนเบาะนอน แขนทั้งสองข้างอยู่หน้าไหล่',
            'training' => 'จัดให้เด็กอยู่ในท่านอนคว่ำ เขย่าของเล่นที่มีเสียงตรงหน้าเด็ก ระยะห่างประมาณ 30 ซม. เมื่อเด็กมองที่ของเล่นแล้วค่อย ๆ เคลื่อนของเล่นมาทางด้านซ้ายหรือขวา เพื่อให้เด็กหันศีรษะมองตาม ถ้าเด็กทำไม่ได้ให้ประคองศีรษะเด็กให้หันตาม'
        ],
        2 => [
            'skill' => 'มองตามถึงกึ่งกลางลำตัว (FM)',
            'method' => 'จัดให้เด็กอยู่ในท่านอนหงาย ถือลูกบอลผ้าสีแดงห่างจากหน้าเด็กประมาณ 20 ซม. ขยับลูกบอลผ้าสีแดงเพื่อกระตุ้นให้เด็กสนใจ แล้วเคลื่อนลูกบอลผ้าสีแดงช้า ๆ ไปทางด้านข้างลำตัวเด็กข้างใดข้างหนึ่งเคลื่อนลูกบอลผ้าสีแดงกลับมาที่จุดกึ่งกลางลำตัวเด็ก',
            'training' => '1. จัดให้เด็กอยู่ในท่านอนหงาย ก้มหน้าให้อยู่ใกล้ ๆ เด็ก ห่างจากหน้าเด็กประมาณ 20 ซม. 2. เรียกให้เด็กสนใจ โดยเรียกชื่อเด็ก เมื่อเด็กสนใจมองให้เคลื่อนหรือเอียงหน้าไปทางด้านข้างลำตัวเด็กอย่างช้าๆ เพื่อให้เด็กมองตาม 3. ถ้าเด็กไม่มองให้ช่วยเหลือโดยการประคองหน้าเด็กให้มองตาม 4. ฝึกเพิ่มเติมโดยใช้ของเล่นที่มีสีสันสดใสกระตุ้นให้เด็กสนใจและมองตาม'
        ],
        3 => [
            'skill' => 'สะดุ้งหรือเคลื่อนไหวร่างกายเมื่อได้ยินเสียงพูดระดับปกติ(RL)',
            'method' => '1. จัดให้เด็กอยู่ในท่านอนหงาย 2. อยู่ห่างจากเด็กประมาณ 60 ซม. เรียกชื่อเด็กจากด้านข้างทีละข้างทั้งซ้ายและขวา โดยพูดเสียงดังปกติ',
            'training' => '1. จัดให้เด็กอยู่ในท่านอนหงาย เรียกชื่อหรือพูดคุยกับเด็กจากด้านข้างทีละข้างทั้งข้างซ้ายและขวาโดยพูดเสียงดังกว่าปกติ 2. หากเด็กสะดุ้งหรือขยับตัวให้ยิ้มและสัมผัสตัวเด็ก ลดเสียงพูดคุยลงเรื่อย ๆ จนให้อยู่ในระดับปกติ'
        ],
        4 => [
            'skill' => 'ส่งเสียงอ้อแอ้ (EL)',
            'method' => 'สังเกตว่าเด็กส่งเสียงอ้อแอ้ในระหว่างทำการประเมิน หรือถามจากพ่อแม่ผู้ปกครอง',
            'training' => 'อุ้มหรือสัมผัสตัวเด็กเบา ๆ มองสบตา แล้วพูดคุยกับเด็กด้วยเสียงสูง ๆ ต่ำ ๆ เพื่อให้เด็กสนใจและหยุดรอให้เด็กส่งเสียงอ้อแอ้ตอบ'
        ],
        5 => [
            'skill' => 'มองจ้องหน้าได้นาน 1 - 2 วินาที(PS)',
            'method' => 'อุ้มเด็กให้ห่างจากหน้าพ่อแม่ ผู้ปกครองหรือผู้ประเมินประมาณ 30 ซม. ยิ้มและพูดคุยกับเด็ก',
            'training' => '1. จัดให้เด็กอยู่ในท่านอนหงายหรืออุ้มเด็ก 2. สบตา พูดคุย ส่งเสียง ยิ้ม หรือทำตาลักษณะต่าง ๆ เช่น ตาโตกะพริบตา เพื่อให้เด็กสนใจมอง เป็นการเสริมสร้างความสัมพันธ์ระหว่างเด็กกับผู้ดูแล โดยทำให้เด็กมีอารมณ์ดี'
        ]
    ];

    // เพิ่มคำถามสำหรับ 1-2 เดือน (ข้อ 6-10)
    if ($age_range == '1-2') {
        $questions_1_2 = [
            6 => [
                'skill' => 'ท่านอนคว่ำ ยกศีรษะตั้งขึ้นได้ 45 องศา นาน 3 วินาที (GM)',
                'method' => '1. จัดให้เด็กอยู่ในท่านอนคว่ำบนพื้นราบ 2. เขย่ากรุ๊งกริ๊งด้านหน้าเด็กเพื่อให้เด็กสนใจ แล้วเคลื่อนขึ้นด้านบน กระตุ้นให้เด็กมองตาม',
                'training' => '1. จัดให้เด็กอยู่ในท่านอนคว่ำ ข้อศอกงอ 2. ใช้หน้าและเสียงของพ่อแม่ ผู้ปกครองหรือผู้ดูแลเด็กพูดคุยกับเด็กตรงหน้าเด็ก เมื่อเด็กมองตามค่อย ๆ เคลื่อนหน้าพ่อแม่ ผู้ปกครองหรือผู้ดูแลเด็กขึ้นด้านบนเพื่อให้เด็กสนใจยกศีรษะ โดยมือยันพื้นไว้แขนเหยียดตรงและหน้าอกพ้นพื้น 3. ฝึกเพิ่มเติมโดยใช้ของเล่นที่มีสีสันสดใสกระตุ้นให้เด็กสนใจและมองตาม'
            ],
            7 => [
                'skill' => 'ส่งเสียงเพื่อแสดงความต้องการ (EL)',
                'method' => 'ในระหว่างที่ประเมิน สังเกตว่าเด็กส่งเสียงเพื่อแสดงความต้องการได้หรือไม่ หรือถามพ่อแม่ผู้ปกครองหรือผู้ดูแลเด็ก',
                'training' => 'เมื่อเด็กมีเสียงส่ง ผู้ดูแลเด็กต้องตอบสนองโดยการดูแลปรับสิ่งที่เด็กต้องการให้ทันทีตามสถานการณ์ เช่น หิวนม ปัสสาวะอุจจาระ นอนอึดอัด หนาว ร้อน เป็นต้น และพูดให้เด็กฟัง เช่น "แม่รู้ว่าลูกหิวนม" "แม่รู้ว่าลูกอึดอัด" เป็นต้น'
            ],
            8 => [
                'skill' => 'ยิ้มให้คนที่สนใจ (PS)',
                'method' => 'สังเกตขณะอยู่กับเด็กหรือถามพ่อแม่ผู้ปกครองหรือผู้ดูแลเด็กว่า "เด็กยิ้มให้คนที่สนใจได้หรือไม่"',
                'training' => '1. ยิ้มและพูดคุยกับเด็กเมื่อทำกิจกรรมต่าง ๆ ให้เด็กทุกครั้งเป็นการเสริมสร้างความสัมพันธ์ระหว่างเด็กกับผู้ดูแล 2. อุ้มเด็กไปพบคนต่าง ๆ ในครอบครัว เพื่อให้เด็กมีโอกาสได้เห็นหน้าและยิ้มให้คนต่าง ๆ 3. พูดกระตุ้นให้เด็กทำตาม เช่น "ยิ้มให้คุณพ่อซิลูก" "ยิ้มให้.....ซิลูก"'
            ],
            9 => [
                'skill' => 'ชอบให้คนถือ อุ้ม (PS)',
                'method' => 'สังเกตขณะอยู่กับเด็กหรือถามพ่อแม่ผู้ปกครองหรือผู้ดูแลเด็กว่า "เด็กชอบให้คนถือ อุ้มหรือไม่"',
                'training' => 'อุ้มเด็กเมื่อเด็กร้องหรือเด็กต้องการ ไม่ควรปล่อยให้เด็กร้องนาน เพราะเด็กจะไม่มีความไว้วางใจ'
            ],
            10 => [
                'skill' => 'นิ่งฟังเมื่อได้ยินเสียงเพลง (RL)',
                'method' => 'เปิดเสียงเพลงให้เด็กฟัง หรือร้องเพลงให้เด็กฟัง โดยให้เด็กอยู่ในท่านอนหงาย',
                'training' => 'เปิดเสียงเพลงให้เด็กฟังทุกวัน เปิดวันละหลายครั้ง และร้องเพลงให้เด็กฟัง'
            ]
        ];
        $questions_0_1 = $questions_1_2; // ใช้เฉพาะคำถาม 6-10
    }

    // เพิ่มคำถามสำหรับ 3-4 เดือน (ข้อ 11-15) 
    if ($age_range == '3-4') {
        $questions_2_3 = [
            11 => [
                'skill' => 'ท่านอนคว่ำยกศีรษะและอกพ้นพื้น (GM)',
                'method' => '1. จัดให้เด็กอยู่ในท่านอนคว่ำบนพื้นราบ 2. เขย่ากรุ๊งกริ๊งด้านหน้าเด็กเพื่อให้เด็กสนใจ แล้วเคลื่อนขึ้นด้านบน กระตุ้นให้เด็กมองตาม',
                'training' => '1. จัดให้เด็กอยู่ในท่านอนคว่ำ ข้อศอกงอ 2. ใช้หน้าและเสียงของพ่อแม่ ผู้ปกครองหรือผู้ดูแลเด็กพูดคุยกับเด็กตรงหน้าเด็ก เมื่อเด็กมองตามค่อย ๆ เคลื่อนหน้าพ่อแม่ ผู้ปกครองหรือผู้ดูแลเด็กขึ้นด้านบนเพื่อให้เด็กสนใจยกศีรษะ โดยมือยันพื้นไว้แขนเหยียดตรงและหน้าอกพ้นพื้น 3. ฝึกเพิ่มเติมโดยใช้ของเล่นที่มีสีสันสดใสกระตุ้นให้เด็กสนใจและมองตาม'
            ],
            12 => [
                'skill' => 'มองตามได้ 180 องศา (FM)',
                'method' => '1. จัดให้เด็กอยู่ในท่านอนหงาย 2. ถือลูกบอลผ้าเสียงครงห่างจากหน้าเด็กประมาณ 30 ซม. 3. กระตุ้นให้เด็กมองที่ลูกบอลผ้าเสียงครง 4. เคลื่อนลูกบอลผ้าเสียงครงเป็นแนวโค้งจากด้านข้างลำตัวไปอีกด้านข้าง',
                'training' => '1. จัดให้เด็กอยู่ในท่านอนหงาย 2. ยื่นหน้าให้ใกล้เด็ก ห่างจากหน้าเด็กประมาณ 30 ซม. 3. กระตุ้นให้เด็กมองหน้า เมื่อเด็กมองแล้วให้เคลื่อนหน้าจากด้านหนึ่งไปอีกด้านหนึ่ง 4. ถ้าเด็กยังไม่มองตาม ให้ประคองหน้าเด็กให้หันมองตาม 5. ฝึกเพิ่มเติมโดยใช้ของเล่นที่มีสีสันสดใสกระตุ้นให้เด็กสนใจและมองตาม'
            ],
            13 => [
                'skill' => 'หันตามเสียงได้ (RL)',
                'method' => '1. จัดให้เด็กอยู่ในท่านอนหงายหรืออุ้มเด็ก หันหน้าออกจากผู้ประเมิน 2. เขย่ากรุ๊งกริ๊งด้านข้างหูข้างหนึ่งประมาณ 60 ซม. และไม่ให้เด็กเห็น',
                'training' => '1. จัดให้เด็กอยู่ในท่านอนหงาย หรืออุ้มเด็กหันหน้าออกจากผู้ดูแลเด็ก 2. เขย่าของเล่นให้มีเสียง 3. เขย่าของเล่นจากด้านข้าง ห่างจากเด็กประมาณ 30 - 45 ซม. และไม่ให้เด็กเห็นของเล่นที่มีเสียง 4. จากนั้นให้พูดคุยและยิ้มกับเด็ก ถ้าเด็กหันมองของเล่น ให้ประคองช่วยเด็กหันตามเสียงและเห็นของเล่นจนระยะ 60 ซม.'
            ],
            14 => [
                'skill' => 'ทำเสียงสูง ๆ ต่ำ ๆ เพื่อแสดงความรู้สึก (EL)',
                'method' => 'ในระหว่างที่ประเมิน สังเกตว่าเด็กส่งเสียงสูง ๆ ต่ำ ๆ ได้หรือไม่ หรือถามพ่อแม่ผู้ปกครองหรือผู้ดูแลเด็ก',
                'training' => 'มองสบตาเด็ก และพูดด้วยเสียงสูง ๆ ต่ำ ๆ เล่นหัวเราะกับเด็ก หรือสัมผัสจุดต่าง ๆ ของร่างกายเด็ก เช่น ใช้นิ้วสัมผัสเบา ๆ ที่ฝ่าเท้า ท้องเอว หรือใช้จมูกสัมผัสหน้าผาก แก้ม จมูก ปากและท้องเด็ก โดยการสัมผัสแต่ละครั้งควรมีจังหวะหนักเบาแตกต่างกันไป'
            ],
            15 => [
                'skill' => 'ยิ้มทักคนที่คุ้นเคย (PS)',
                'method' => 'สังเกตขณะอยู่กับเด็กหรือถามพ่อแม่ผู้ปกครองหรือผู้ดูแลเด็กว่า "เด็กยิ้มทักคนที่คุ้นเคยก่อนได้หรือไม่"',
                'training' => '1. ยิ้มและพูดคุยกับเด็กเมื่อทำกิจกรรมต่าง ๆ ให้เด็กทุกครั้งเป็นการเสริมสร้างความสัมพันธ์ระหว่างเด็กกับผู้ดูแล 2. อุ้มเด็กไปหาคนที่คุ้นเคย เช่น ปู่ ย่า ตา ยาย พ่อแม่ ผู้ปกครองยิ้มทักคนที่คุ้นเคยให้เด็กดู 3. พูดกระตุ้นให้เด็กทำตาม เช่น "ยิ้มให้คุณพ่อซิลูก" "ยิ้มให้.....ซิลูก"'
            ]
        ];
        $questions_0_1 = $questions_2_3; // ใช้เฉพาะคำถาม 11-15
    }

    // เพิ่มคำถามสำหรับ 5-6 เดือน (ข้อ 16-20)
    if ($age_range == '5-6') {
        $questions_5_6 = [
            16 => [
                'skill' => 'ยันตัวขึ้นจากท่านอนคว่ำโดยเหยียดแขนตรงทั้งสองข้างได้(GM)',
                'method' => 'จัดให้เด็กอยู่ในท่านอนคว่ำ เขย่ากรุ๊งกริ๊งด้านหน้าเด็ก กระตุ้นให้เด็กมองสนใจแล้วเคลื่อนขึ้นด้านบน กระตุ้นให้เด็กมองตาม ผ่าน: เด็กสามารถใช้ฝ่ามือทั้งสองข้างยันตัวขึ้นจนข้อศอกเหยียดตรง ท้องและหน้าอกต้องยกขึ้นพ้นพื้น',
                'training' => '1. จัดให้เด็กอยู่ในท่านอนคว่ำ 2. ถือของเล่นไว้ด้านหน้าเหนือศีรษะเด็ก 3. เรียกชื่อเด็กให้มองดูของเล่นแล้วเคลื่อนของเล่นให้สูงขึ้นเหนือศีรษะอย่างช้า ๆ เพื่อให้เด็กยกศีรษะตาม โดยมือยันพื้นไว้ แขนเหยียดตรงจนหน้าอกและท้องพ้นพื้น'
            ],
            17 => [
                'skill' => 'เอื้อมมือหยิบ และถือวัตถุไว้ขณะอยู่ในท่านอนหงาย (FM)',
                'method' => 'จัดให้เด็กอยู่ในท่านอนหงาย ถือกรุ๊งกริ๊งให้ห่างจากตัวเด็กประมาณ 20 - 30 ซม.ที่จุดกึ่งกลางลำตัวอาจกระตุ้นให้เด็กสนใจและหยิบกรุ๊งกริ๊งได้ ผ่าน: เด็กสามารถเอื้อมมือข้างใดข้างหนึ่งไปหยิบและถือกรุ๊งกริ๊งได้ (อาจจะมีการเคลื่อนไหวแบบสะเปะสะปะเพื่อหยิบกรุ๊งกริ๊ง)',
                'training' => '1. จัดให้เด็กอยู่ในท่านอนหงาย เขย่าของเล่นให้ห่างจากตัวเด็กในระยะที่เด็กเอื้อมถึง 2. ถ้าเด็กไม่เอื้อมมือออกมาคว้าของเล่น ให้ใช้ของเล่นแตะเบา ๆที่หลังมือเด็ก หรือจับมือเด็กให้เอื้อมมาหยิบของเล่น ทำซ้ำจนเด็กสามารถเอื้อมมือมาหยิบของเล่นได้เอง 3. อาจแขวนโมบายในระยะที่เด็กเอื้อมถึง เพื่อให้เด็กสนใจคว้าหยิบ'
            ],
            18 => [
                'skill' => 'หันตามเสียงเรียก (RL)',
                'method' => 'อยู่ข้างหลังเด็กเยื้องไปทางซ้ายหรือขวาห่างจากเด็กประมาณ 20 - 30 ซม. ใช้มือป้องปากแล้วพูดคุยและเรียกเด็กหลาย ๆครั้ง และทำซ้ำโดยเยื้องไปอีกด้านตรงข้าม ผ่าน: เด็กหันตามเสียงเรียกหรือเสียงพูดคุย',
                'training' => '1. ให้เด็กนั่งบนเบาะนอน 2. พยุงอยู่ด้านหลังระยะห่างตัวเด็ก 30 ซม. พูดคุยกับเด็กด้วยเสียงปกติ รอให้เด็กหันมาทางทิศของเสียง ให้ยิ้มและเล่นกับเด็ก (ขณะฝึกอย่าให้มีเสียงอื่นรบกวน) 3. ถ้าเด็กไม่มองให้ประคองหน้าเด็กหันตามเสียงจนเด็กสามารถหันตามเสียงได้เอง ถ้าเด็กยังไม่หันให้พูดเสียงดังขึ้น เมื่อหันมองลดระดับเสียงลงจนเสียงปกติ'
            ],
            19 => [
                'skill' => 'เลียนแบบการเล่นทำเสียงได้(EL)',
                'method' => 'ใช้ปากทำเสียงให้เด็กดู เช่น จุ๊บ หรือ ถามพ่อแม่ ผู้ปกครองหรือผู้ดูแลเด็กว่าเด็กสามารถขยับปากทำเสียง จุ๊บ ได้หรือไม่ ผ่าน: เด็กสามารถเลียนแบบการเล่นทำเสียงตามได้',
                'training' => '1. สบตาและพูดคุยกับเด็ก ใช้ริมฝีปากทำเสียง เช่น "จุ๊บจุ๊บ" เดาะลิ้นหรือจับมือเด็กมาไว้ที่ปากแล้วขยับตีปากเบา ๆ กระตุ้นให้ออกเสียง"วา..วา" ให้เด็กดูหลาย ๆ ครั้ง แล้วรอให้เด็กทำตาม จนเด็กสามารถเลียนแบบได้ 2. ร้องเพลงง่าย ๆ ที่มีเสียงสูง ๆ ต่ำ ๆ ให้เด็กฟัง เช่น เพลงช้างเพลงเป็ด เป็นต้น'
            ],
            20 => [
                'skill' => 'สนใจฟังคนพูดและสามารถมองไปที่ของเล่นที่ผู้ทดสอบเล่นกับเด็ก (PS)',
                'method' => 'นั่งหันหน้าเข้าหาเด็กแล้วเรียกชื่อเด็กเมื่อเด็กมองแล้วหยิบตุ๊กตาผ้าให้เด็กเห็นในระดับสายตาเด็ก กระตุ้นให้เด็กสนใจตุ๊กตาผ้าด้วยคำพูด ถ้าเด็กทำไม่ได้ในครั้งแรก ให้ทำซ้ำได้รวมไม่เกิน 3 ครั้ง ผ่าน: เด็กสบตากับผู้ประเมิน และมองที่ตุ๊กตาผ้าได้นาน 5 วินาที อย่างน้อย 1ใน 3 ครั้ง',
                'training' => '1. จัดเด็กนั่งหันหน้าเข้าหาพ่อแม่ ผู้ปกครองหรือผู้ดูแลเด็ก 2. เรียกชื่อและสบตา พูดคุยกับเด็กเมื่อเด็กมองสบตาแล้ว นำของเล่นมาอยู่ในระดับสายตาเด็ก พูดคุยกับเด็กเกี่ยวกับของเล่น เช่น"วันนี้แม่มีพี่ตุ๊กตามาเล่นกับหนู พี่ตุ๊กตามีผมสีน้ำตาลใส่ชุดสีเขียว"'
            ]
        ];
        $questions_0_1 = $questions_5_6; // ใช้เฉพาะคำถาม 16-20
    }

    // เพิ่มคำถามสำหรับ 7-8 เดือน (ข้อ 21-26)
    if ($age_range == '7-8') {
        $questions_3_4 = [
            21 => [
                'skill' => 'นั่งได้มั่นคง และเอี้ยวตัวใช้มือเล่นได้อย่างอิสระ (sit stable)(GM)',
                'method' => '1. จัดเด็กอยู่ในท่านั่ง 2. วางกรุ๊งกริ๊งไว้ด้านข้างเยื้องไปทาง
                ด้านหลัง กระตุ้นให้เด็กสนใจหยิบกรุ๊งกริ๊ง ผ่าน:  เด็กสามารถนั่งได้มั่นคง และเอี้ยวตัวหรือหมุนตัวไปหยิบกรุ๊งกริ๊งแล้วกลับมานั่งตัวตรงอีก',
                'training' => '1. จัดเด็กอยู่ในท่านั่ง วางของเล่นไว้ที่พื้นทางด้านข้างเยื้องไปด้านหลังของเด็กในระยะที่เด็กเอื้อมถึง 2. เรียกชื่อเด็กให้สนใจของเล่นเพื่อจะได้เอี้ยวตัวไปหยิบของเล่น
                ถ้าเด็กทำไม่ได้ให้เลื่อนของเล่นใกล้ตัวเด็กอีกเล็กน้อย แล้วช่วยจับแขนเด็กให้เอี้ยวตัวไปหยิบของเล่นนั้น ทำอีกข้างสลับกันไป จนเด็กหยิบได้เอง'
            ],
            22 => [
                'skill' => 'ยืนเกาะ เครื่องเรือนสูงระดับอกได้ (GM)',
                'method' => '1. วางกรุ๊งกริ๊งไว้บนเครื่องเรือน เช่น โต๊ะหรือเก้าอี้ 2. จัดเด็กยืนเกาะเครื่องเรือน 3. กระตุ้นให้เด็กสนใจที่กรุ๊งกริ๊ง ผ่าน: เด็กสามารถยืนเกาะเครื่องเรือน
                ได้เอง อย่างน้อย 10 วินาที โดยใช้แขนพยุงตัวไว้และสามารถขยับขาได้',
                'training' => '1. จัดเด็กให้ยืนเกาะพ่อแม่ ผู้ปกครองหรือผู้ดูแลเด็ก/เครื่องเรือน
                2. จับที่สะโพกเด็กก่อน ต่อมาเปลี่ยนจับที่เข่า แล้วจึงจับมือเด็กเกาะที่เครื่องเรือน
                3. เมื่อเด็กเริ่มทำได้ ให้เด็กยืนเกาะเครื่องเรือนเอง โดยไม่ใช้หน้าอกพิง หรือท้าวแขนเพื่อพยุงตัว
                4. คอยอยู่ใกล้ ๆ เด็ก อาจเปิดเพลงแล้ว กระตุ้นให้เต้นตามจังหวะเพลง'
            ],
            23 => [
                'skill' => 'จ้องมองไปที่หนังสือพร้อมกับผู้ใหญ่นาน 2 - 3 วินาที (FM)',
                'method' => 'จัดเด็กนั่งบนตัก ให้พ่อแม่ ผู้ปกครองหรือผู้ดูแลเด็กเปิดหนังสือ ชี้ชวนและพูดกับเด็กเกี่ยวกับรูปภาพนั้น ๆ',
                'training' => '1. อุ้มเด็กนั่งบนตัก เปิดหนังสือพร้อมกับพูดคุย ชี้ชวนให้เด็กดูรูปภาพในหนังสือ เพื่อกระตุ้นพัฒนาการทางอารมณ์โดยการอ่านหนังสือร่วมกันกับเด็ก
                2. หากเด็กยังไม่มอง ให้ประคองหน้าเด็กให้มองที่รูปภาพในหนังสือ '
            ],
            24 => [
                'skill' => 'เด็กหันตามเสียงเรียกชื่อ (RL)',
                'method' => '1. ให้เด็กเล่นอย่างอิสระ ผู้ประเมินอยู่ห่างจากเด็ก 2. ประมาณ 120 ซม. แล้วเรียกชื่อเด็กด้วยเสียงปกติ',
                'training' => 'เรียกชื่อเด็กด้วยน้ำเสียงปกติบ่อย ๆ ในระยะห่างประมาณ 120 ซม.ควรเป็นชื่อที่ใช้เรียกเด็กเป็นประจำ ถ้าเด็กไม่หัน เมื่อเรียกชื่อแล้ว
                ให้ประคองหน้าเด็กให้หันมามองจนเด็กสามารถทำได้เอง'
            ],
            25 => [
                'skill' => 'เลียนเสียงพูดคุย (EL)',
                'method' => 'ถามพ่อแม่ ผู้ปกครองหรือผู้ดูแลเด็กหรือสังเกตระหว่างประเมินว่าเด็กทำเสียงเลียนเสียงพูดหรือไม่',
                'training' => 'พูดคุย เล่นกับเด็ก และออกเสียงใหม่ ๆ ให้เด็กเลียนเสียงตาม เช่นจา มา ปา ดา อู ตา หรือออกเสียงตามทำนองเพลง หรือร้องเพลงเช่น เพลงจับปูดำ'
            ],
            26 => [
                'skill' => 'เด็กเล่นจ๊ะเอ๋ได้และมองหาหน้าของผู้เล่นได้ถูกทิศทาง (PS)',
                'method' => '1. ให้เด็กมองผู้ประเมิน 2. ใช้ผ้าที่เตรียมไว้บังหน้าตนเอง 
                3. โผล่หน้าด้านเดียวกัน 2 ครั้งพร้อมกับพูด “จ๊ะเอ๋” ครั้งที่ 3 ไม่โผล่หน้าแต่ให้พูดคำว่า “จ๊ะเอ๋” แล้วให้ผู้ประเมินมองผ่านรูผ้าว่าเด็กจ้องมองด้านที่ผู้ประเมินเคยโผล่หน้าได้หรือไม่',
                'training' => '1. เล่น “จ๊ะเอ๋” กับเด็กบ่อยๆ โดยใช้มือปิดหน้าหลังจากนั้นเปลี่ยนเป็นใช้ผ้าปิดหน้าเล่น “จ๊ะเอ๋” กับเด็ก โดยการเล่นร่วมกันกับเด็กเป็นการเสริมสร้างความสัมพันธ์และการกระตุ้นพัฒนาการทางอารมณ์
                2. ให้พ่อแม่ ผู้ปกครอง หรือผู้ดูแลเด็ก ใช้ผ้าเช็ดหน้าหรือผ้าผืนเล็ก ๆบังหน้าไว้ โผล่หน้าออกมาจากผ้าเช็ดหน้าด้านใดด้านหนึ่งพร้อมกับพูดว่า “จ๊ะเอ๋” หยุดรอจังหวะเพื่อให้เด็กหันมามองหรือยิ้มเล่นโต้ตอบ
                ฝึกบ่อย ๆ จนกระทั่งเด็กสามารถยื่นโผล่หน้าร่วมเล่นจ๊ะเอ๋ได้
                3. ซ่อนของเล่นไว้ใต้ผืนผ้าแล้วให้เด็กหาโดยเริ่มจากซ่อนไว้บางส่วนแล้วค่อยซ่อนทั้งชิ้น เพื่อฝึกทักษะการสังเกตและความจำ'
            ]
        ];
        $questions_0_1 = $questions_3_4; // ใช้เฉพาะคำถาม 21-26
    }

    // เพิ่มคำถามสำหรับ 9 เดือน (ข้อ 27-34)
    if ($age_range == '9') {
        $questions_9 = [
            27 => [
                'skill' => 'ลุกขึ้นนั่งได้จากท่านอน (GM)',
                'method' => '1. จัดให้เด็กอยู่ในท่านอนหงายหรือนอนคว่ำ2. กระตุ้นให้เด็กลุกขึ้นนั่ง เช่น ใช้ลูกบอลกระตุ้น หรือ ตบมือ/ใช้ท่าทางเรียกกริ๊ง 
                ผ่าน: เด็กสามารถลุกขึ้นนั่งจากท่านอนได้เอง',
                'training' => '1. จัดเด็กในท่านอนคว่ำ จับเข่างอทั้ง 2 ข้าง จับมือเด็กทั้ง 2 ข้างยันพื้น 2. กดที่สะโพกเด็กทั้งสองข้าง เพื่อให้เด็กยันตัวลุกขึ้นมาอยู่ในท่านั่ง'
            ],
            28 => [
                'skill' => 'ยืนอยู่ได้โดยใช้มือเกาะเครื่องเรือนสูงระดับอก (GM)',
                'method' => 'จัดเด็กยืนเกาะเครื่องเรือน พร้อมทั้งวางลูกบอล หรือกรุ๊งกริ๊งไว้ให้เด็กเล่น ผ่าน: เด็กสามารถยืนอยู่ได้โดยใช้มือเกาะที่เครื่องเรือน ไม่ใช้หน้าอกพิง หรือแขนท้าวเพื่อพยุงตัว',
                'training' => '1. จัดเด็กให้ยืนเกาะเครื่องเรือน 
                2. จับที่สะโพกเด็กก่อน ต่อมาเปลี่ยนจับที่เข่า แล้วจึงจับมือเด็กเกาะที่เครื่องเรือน
                3. เมื่อเด็กเริ่มทำได้ ให้เด็กยืนเกาะเครื่องเรือนเอง โดยไม่ใช้หน้าอกพิง หรือแขนท้าวเพื่อพยุงตัว
                4. อาจเปิดเพลงกระตุ้นให้เด็กยืนได้นานหรือเต้นตามจังหวะแต่ต้องคอยอยู่ใกล้ ๆ เพื่อระวังอันตราย'
            ],
            29 => [
                'skill' => 'หยิบก้อนไม้จากพื้นและถือไว้มือละชิ้น (FM)',
                'method' => 'วางก้อนไม้ลงบนพื้นพร้อมกับบอกให้เด็กหยิบก้อนไม้  หมายเหตุ: หากเด็กไม่หยิบสามารถกระตุ้นให้เด็กสนใจโดยการเคาะก้อนไม้ 
                ผ่าน : เด็กสามารถหยิบก้อนไม้ทั้งสองก้อนขึ้นพร้อมกัน หรือทีละก้อนก็ได้ และถือก้อนไม้ไว้ในมือข้างละ 1 ก้อน ทั้งสองข้าง',
                'training' => '1. นำวัตถุสีสดใสขนาดประมาณ 1 นิ้ว เช่น ก้อนไม้ 2 ก้อน(ใช้วัตถุเหมือนกัน 2 ชิ้น) 
                2. เคาะของเล่นกับโต๊ะทีละชิ้นเพื่อกระตุ้นให้เด็กหยิบ
                3. ถ้าเด็กไม่หยิบ ช่วยจับมือเด็กให้หยิบ '
            ],
            30 => [
                'skill' => 'ใช้นิ้วหัวแม่มือ และนิ้วอื่น ๆหยิบของขึ้นจากพื้น (FM)',
                'method' => '1. วางวัตถุชิ้นเล็ก 1 ชิ้นบนพื้น โดยให้อยู่ในระยะที่เด็กเอื้อมมือไปหยิบได้ง่าย2. บอกเด็กให้หยิบวัตถุ หรือแสดงให้เด็กดูก่อน 
                ผ่าน: เด็กหยิบวัตถุขึ้นจากพื้นได้โดยใช้นิ้วหัวแม่มือและนิ้วอื่น ๆ (ไม่ใช่หยิบขึ้นด้วยฝ่ามือ)',
                'training' => '1. นำวัตถุสีสดใส เช่น ก้อนไม้ เชือก หรืออาหารชิ้นเล็ก ๆเช่น แตงกวา ขนมปัง วางตรงหน้าเด็ก
                2. หยิบของให้เด็กดู แล้วกระตุ้นให้เด็กหยิบ
                3. ถ้าเด็กทำไม่ได้ ช่วยจับมือเด็ก ให้หยิบสิ่งของหรืออาหารชิ้นเล็กลดการช่วยเหลือลงจนเด็กสามารถทำได้เอง
                4. ควรระวังไม่ให้เด็กเล่นหรือหยิบของที่เป็นอันตรายเข้าปากเช่น กระดุม เหรียญ เม็ดยา เมล็ดถั่ว เมล็ดผลไม้ เป็นต้น'
            ],
            31 => [
                'skill' => 'ทำตามคำสั่งง่าย ๆ เมื่อใช้ท่าทางประกอบ (RL)',
                'method' => 'สบตาเด็ก แล้วบอกให้เด็กโบกมือหรือตบมือ โดยใช้ท่าทางประกอบ เช่น โบกมือ
                ผ่าน : เด็กสามารถทำท่าทางตามคำสั่งง่าย ๆ ที่มีท่าทางประกอบ เช่น โบกมือบ๊ายบาย ตบมือ หรือยกมือสาธุ แม้ยังไม่สมบูรณ์',
                'training' => '1. เล่นกับเด็กโดยใช้คำสั่งง่าย ๆ เช่น โบกมือ ตบมือ พร้อมกับทำท่าทางประกอบ ฝึกบ่อย ๆ จนเด็กทำได้
                2. ถ้าเด็กไม่ทำ ให้จับมือทำและค่อย ๆ ลดความช่วยเหลือลงโดยเปลี่ยนเป็นจับข้อมือ จากนั้นเปลี่ยนเป็นแตะข้อศอก เมื่อเริ่มตบมือเองได้แล้ว ลดการช่วยเหลือลง เป็นบอกให้ทำอย่างเดียว
                3. เล่นทำท่าทางประกอบเพลง ฝึกการเคลื่อนไหวของนิ้วมือตามเพลง เช่น “แมงมุม” “นิ้ว...อยู่ไหน”'
            ],
            32 => [
                'skill' => 'เด็กรู้จักการปฏิเสธด้วยการแสดงท่าทาง (EL)',
                'method' => 'สังเกต หรือถามว่าเด็กปฏิเสธสิ่งของอาหาร หรือการช่วยเหลือจากพ่อแม่ผู้ปกครองหรือผู้ดูแลเด็กได้หรือไม่
                ผ่าน : เด็กสามารถใช้ท่าทางเดิมในการปฏิเสธ เช่น ส่ายหน้า ใช้มือผลักออกไปหันหน้าหนี',
                'training' => '1. เมื่อคนแปลกหน้ายื่นของให้ หรือขออุ้ม ให้พ่อแม่ ผู้ปกครองหรือผู้ดูแลเด็ก ส่ายหน้า พร้อมกับพูดว่า “ไม่เอา” ให้เด็กเลียนแบบเพื่อให้เด็กรู้จักปฏิเสธ โดยการแสดงท่าทาง
                2. เมื่อเด็กรับประทานอาหารหรือขนมอิ่มแล้ว ถามเด็กว่า “กินอีกไหม” แล้วส่ายศีรษะพร้อมกับพูดว่า “ไม่กิน” ให้เด็กเลียนแบบตามทำเช่นนี้กับสถานการณ์อื่น ๆ เพื่อให้เด็กเรียนรู้เพิ่มขึ้น'
            ],
            33 => [
                'skill' => 'เลียนเสียงคำพูดที่คุ้นเคยได้อย่างน้อย 1 เสียง (EL)',
                'method' => 'ถามพ่อแม่ ผู้ปกครองหรือผู้ดูแลเด็ก หรือสังเกตระหว่างประเมินว่าเด็กทำเสียงเลียนเสียงพูดได้หรือไม่
                ผ่าน : เด็กเลียนเสียงคำพูดที่คุ้นเคยได้อย่างน้อย 1 เสียง เช่น “แม่” “ไป” “หม่ำ” “ป(ล)า ” แต่เด็กอาจจะออกเสียงยังไม่ชัด',
                'training' => 'เปล่งเสียงที่เด็กเคยทำได้แล้ว เช่น ป๊ะ จ๊ะ จ๋า รอให้เด็กเลียนเสียงตามจากนั้นเปล่งเสียงที่แตกต่างจากเดิมให้เด็กเลียนเสียงตาม เช่น“แม่” “ไป” “หม่ำ” “ป(ล)า ” '
            ],
            34 => [
                'skill' => 'ใช้นิ้วหยิบอาหารกินได้ (PS)',
                'method' => 'ถามจากพ่อแม่ ผู้ปกครองหรือผู้ดูแลเด็กว่าเด็กใช้นิ้วหยิบอาหารกินได้หรือไม่
                ผ่าน : เด็กสามารถใช้นิ้วมือหยิบอาหารกินได้',
                'training' => '1. วางอาหารที่เด็กชอบและหยิบง่ายขนาด 1 คำ เช่น ขนมปังกรอบตรงหน้าเด็ก
                2. จับมือเด็กหยิบอาหารใส่ปาก แล้วปล่อยให้เด็กทำเองฝึกบ่อย ๆจนสามารถหยิบอาหารกินได้เอง'
            ]
        ];
        $questions_0_1 = $questions_9; // ใช้เฉพาะคำถาม 27-34
    }

    // เพิ่มคำถามสำหรับ 10-12 เดือน (ข้อ 35-39)
    if ($age_range == '10-12') {
        $questions_10_12 = [
            35 => [
                'skill' => 'ยืนนาน 2 วินาที (GM)',
                'method' => 'จัดให้เด็กอยู่ในท่ายืนโดยไม่ต้องช่วยพยุง
                ผ่าน : เด็กสามารถยืนได้เอง โดยไม่ต้องช่วยพยุงได้นาน อย่างน้อย 2 วินาที',
                'training' => 'พยุงลำตัวเด็กให้ยืน เมื่อเด็กเริ่มยืนทรงตัวได้แล้ว ให้เปลี่ยนมาจับข้อมือเด็ก แล้วค่อย ๆ ปล่อยมือเพื่อให้เด็กยืนเอง'
            ],
            36 => [
                'skill' => 'จีบนิ้วมือเพื่อหยิบของชิ้นเล็ก (FM)',
                'method' => '1. วางวัตถุชิ้นเล็กๆ ตรงหน้าเด็ก 1 ชิ้น 2. กระตุ้นความสนใจของเด็กไปที่วัตถุชิ้นเล็ก แล้วบอกให้เด็กหยิบ หรืออาจหยิบให้เด็กดู สังเกตการหยิบของเด็ก
                ผ่าน : เด็กสามารถจีบนิ้วโดยใช้นิ้วหัวแม่มือและนิ้วชี้หยิบวัตถุชิ้นเล็กขึ้นมาได้ 1 ใน 3 ครั้ง',
                'training' => '1. แบ่งขนมหรืออาหารเป็นชิ้นเล็ก ๆ ประมาณ 1 ซม. ไว้ในจานแล้วหยิบอาหารหรือขนมโดยใช้นิ้วหัวแม่มือและนิ้วชี้หยิบให้เด็กดูแล้วบอกให้เด็กทำตาม
                2. ถ้าเด็กทำไม่ได้ ช่วยเหลือเด็กโดยจับรวบนิ้วกลาง นิ้วนางและนิ้วก้อยเข้าหาฝ่ามือ เพื่อให้เด็กใช้นิ้วหัวแม่มือและนิ้วชี้หยิบวัตถุ
                3. เล่นกิจกรรมที่เด็กต้องใช้นิ้วหัวแม่มือและนิ้วชี้แตะกันเป็นจังหวะหรือเล่นร้องเพลงแมงมุมขยุ้มหลังคาประกอบท่าทางจีบนิ้ว'
            ],
            37 => [
                'skill' => 'โบกมือหรือตบมือตามคำสั่ง (RL)',
                'method' => 'สบตาเด็กแล้วบอกให้เด็กโบกมือ หรือตบมือโดยห้ามใช้ท่าทางประกอบ
                ผ่าน : เด็กสามารถทำตามคำสั่ง แม้ไม่ถูกต้องแต่พยายามยกแขนและเคลื่อนไหวมืออย่างน้อย 1 ใน 3 ครั้ง',
                'training' => '1. เล่นกับเด็กโดยใช้คำสั่งง่าย ๆ เช่น โบกมือ ตบมือ พร้อมกับทำท่าทางประกอบ
                2. ถ้าเด็กไม่ทำ ให้จับมือทำและค่อย ๆ ลดความช่วยเหลือลงโดยเปลี่ยนเป็นจับข้อมือ จากนั้นเปลี่ยนเป็นแตะข้อศอก เมื่อเริ่มตบมือเองได้แล้ว ลดการช่วยเหลือลงเป็นบอกหรือบอกให้ทำอย่างเดียว'
            ],
            38 => [
                'skill' => 'แสดงความต้องการ โดยทำท่าทาง หรือเปล่งเสียง (EL)',
                'method' => 'ถามพ่อแม่ ผู้ปกครองหรือผู้ดูแลเด็กว่าเมื่อเด็กต้องการสิ่งต่าง ๆ เด็กทำอย่างไร
                ผ่าน : เด็กแสดงความต้องการด้วยการทำท่าทาง เช่น ยื่นมือให้อุ้ม ชี้ ดึงเสื้อ หรือเปล่งเสียง',
                'training' => 'นำของเล่น หรืออาหารที่เด็กชอบ 2 – 3 อย่าง วางไว้ด้านหน้าเด็กถามเด็กว่า “หนูเอาอันไหน” หรือถามว่า “หนูเอาไหม” รอให้เด็กแสดงความต้องการ เช่น ชี้ แล้วจึงจะให้ของ ทำเช่นนี้ทุกครั้ง
                เมื่อเด็กต้องการของเล่นหรืออาหาร เพื่อฝึกการสื่อสารความต้องการเบื้องต้น'
            ],
            39 => [
                'skill' => 'เล่นสิ่งของตามประโยชน์ของสิ่งของได้ (PS)',
                'method' => '1. ยื่นของเล่นที่เตรียมไว้ให้เด็กครั้งละ1 ชิ้น จนครบ 4 ชนิด
                2. สังเกตเด็กเล่นของเล่นทั้ง 4 ชนิดว่าตรงตามประโยชน์หรือไม่ หรือถามจากพ่อแม่ผู้ปกครองหรือผู้ดูแลเด็ก
                ผ่าน : เด็กเล่นสิ่งของตามประโยชน์ได้ถูกต้องอย่างน้อย 1 ใน 4 ชิ้น เช่น เล่นหวีผมป้อนอาหาร ดื่มน้ำ',
                'training' => 'ฝึกในสถานการณ์ต่าง ๆ เช่น การหวีผม การแปรงฟัน การป้อนอาหารเด็กโดยทำให้เด็กดู และกระตุ้นให้เด็กทำตาม'
            ]
        ];
        $questions_0_1 = $questions_10_12; // ใช้เฉพาะคำถาม 35-39
    }

    return $questions_0_1;
}

// ดึงคำถามตามช่วงอายุ
$questions = getQuestionsByAgeRange($evaluation['eva_age_range']);
?>

<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>รายละเอียดการประเมิน - DSPM</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            padding-top: 20px;
            padding-bottom: 50px;
        }
        .card {
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            border-radius: 20px;
            border: none;
            margin-bottom: 20px;
        }
        .card-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 20px 20px 0 0 !important;
        }
        .btn-purple {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 25px;
            color: white;
            padding: 10px 25px;
            transition: all 0.3s ease;
        }
        .btn-purple:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
            color: white;
        }
        .child-photo {
            width: 100px;
            height: 100px;
            object-fit: cover;
            border-radius: 50%;
            border: 5px solid white;
        }
        .category-card {
            border-left: 5px solid #667eea;
            margin-bottom: 20px;
        }
        .status-badge {
            font-size: 0.9rem;
            padding: 8px 15px;
        }
        .checked-item {
            color: #28a745;
        }
        .unchecked-item {
            color: #6c757d;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-body text-center">
                        <h2 class="mb-0">
                            <i class="fas fa-chart-line text-primary me-2"></i>
                            รายละเอียดการประเมินพัฒนาการ
                        </h2>
                    </div>
                </div>
            </div>
        </div>

        <!-- Child Info & Evaluation Details -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="fas fa-user me-2"></i>
                            ข้อมูลการประเมิน
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row align-items-center">
                            <div class="col-md-3 text-center mb-3 mb-md-0">
                                <?php if ($evaluation['photo']): ?>
                                    <img src="../uploads/children/<?= htmlspecialchars($evaluation['photo']) ?>" 
                                         alt="รูปเด็ก" class="child-photo">
                                <?php else: ?>
                                    <div class="child-photo bg-light d-flex align-items-center justify-content-center">
                                        <i class="fas fa-user fa-2x text-muted"></i>
                                    </div>
                                <?php endif; ?>
                            </div>
                            <div class="col-md-9">
                                <h4 class="text-primary mb-2"><?= htmlspecialchars($evaluation['child_name']) ?></h4>
                                <div class="row">
                                    <div class="col-md-6 mb-2">
                                        <strong>ช่วงอายุ:</strong> 
                                        <?php 
                                        $age_display = $evaluation['eva_age_range'];
                                        switch($age_display) {
                                            case '0-1': echo '0-1 เดือน'; break;
                                            case '1-2': echo '1-2 เดือน'; break;
                                            case '2-3': echo '2-3 เดือน'; break;
                                            case '3-4': echo '3-4 เดือน'; break;
                                            case '5-6': echo '5-6 เดือน'; break;
                                            default: echo htmlspecialchars($age_display) . ' เดือน';
                                        }
                                        ?>
                                    </div>
                                    <div class="col-md-6 mb-2">
                                        <strong>เวอร์ชัน:</strong> <?= $evaluation['eva_version'] ?>
                                    </div>
                                    <div class="col-md-6 mb-2">
                                        <strong>วันที่ประเมิน:</strong> 
                                        <?= date('d/m/Y H:i', strtotime($evaluation['eva_evaluation_time'])) ?>
                                    </div>
                                    <div class="col-md-6 mb-2">
                                        <strong>ผลการประเมิน:</strong>
                                        <span class="badge bg-success"><?= $evaluation['eva_total_score'] ?> ผ่าน</span>
                                        <span class="badge bg-danger"><?= ($evaluation['eva_total_questions'] - $evaluation['eva_total_score']) ?> ไม่ผ่าน</span>
                                    </div>
                                        <strong>คะแนนรวม:</strong> 
                                        <span class="badge bg-primary status-badge">
                                            <?= $evaluation['eva_total_score'] ?>/<?= $evaluation['eva_total_questions'] ?>
                                        </span>
                                    </div>
                                    <?php if ($evaluation['eva_notes']): ?>
                                        <div class="col-12 mt-2">
                                            <strong>หมายเหตุ:</strong>
                                            <p class="mt-1 p-2 bg-light rounded">
                                                <?= nl2br(htmlspecialchars($evaluation['eva_notes'])) ?>
                                            </p>
                                        </div>
                                    <?php endif; ?>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Evaluation Details -->
        <div class="row">
            <?php foreach ($questions as $question_id => $data): ?>
                <div class="col-12 mb-4">
                    <div class="card question-card">
                        <div class="card-header">
                            <h6 class="mb-0">
                                <i class="fas fa-clipboard-check me-2"></i>
                                ข้อ <?= $question_id ?>: <?= htmlspecialchars($data['skill']) ?>
                            </h6>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-4 mb-3">
                                    <h6 class="text-primary">
                                        <i class="fas fa-search me-1"></i>วิธีการประเมิน:
                                    </h6>
                                    <p class="small text-muted mb-0"><?= nl2br(htmlspecialchars($data['method'])) ?></p>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <h6 class="text-success">
                                        <i class="fas fa-dumbbell me-1"></i>วิธีฝึกทักษะ:
                                    </h6>
                                    <p class="small text-muted mb-0"><?= nl2br(htmlspecialchars($data['training'])) ?></p>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <h6 class="text-warning">
                                        <i class="fas fa-star me-1"></i>ผลการประเมิน:
                                    </h6>
                                    <?php 
                                    $question_key = "question_" . $question_id;
                                    $is_passed = isset($responses[$question_key]) && $responses[$question_key]['passed'] == 1;
                                    ?>
                                    <div class="text-center">
                                        <span class="badge fs-6 <?= $is_passed ? 'bg-success' : 'bg-danger' ?> px-3 py-2">
                                            <i class="fas fa-<?= $is_passed ? 'check-circle' : 'times-circle' ?> me-2"></i>
                                            <?= $is_passed ? 'ผ่าน' : 'ไม่ผ่าน' ?>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            <?php endforeach; ?>
        </div>

        <!-- Action Buttons -->
        <div class="row mt-4">
            <div class="col-12 text-center">
                <a href="evaluation_history.php?child_id=<?= $evaluation['eva_child_id'] ?>" 
                   class="btn btn-purple me-2">
                    <i class="fas fa-arrow-left me-2"></i>กลับไปดูประวัติ
                </a>
                <a href="children_list.php" class="btn btn-outline-secondary">
                    <i class="fas fa-home me-2"></i>กลับหน้าหลัก
                </a>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
